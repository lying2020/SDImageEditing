# é¡¹ç›®è¿è¡ŒæŒ‡å—

## ğŸ“‹ é¡¹ç›®è¯´æ˜

è¿™æ˜¯ä¸€ä¸ª**æ–‡æœ¬é©±åŠ¨çš„å›¾åƒç¼–è¾‘**é¡¹ç›®ï¼ˆCVPR 2024ï¼‰ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ï¼š
- é€šè¿‡æ–‡æœ¬æç¤ºï¼ˆtext promptï¼‰æ¥ç¼–è¾‘å›¾åƒ
- **ä¸éœ€è¦**æ‰‹åŠ¨æä¾› mask æˆ– sketch
- è‡ªåŠ¨æ‰¾åˆ°éœ€è¦ç¼–è¾‘çš„åŒºåŸŸå¹¶å®Œæˆç¼–è¾‘

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå®‰è£…

```bash
# 1. åˆ›å»ºcondaç¯å¢ƒ
conda create -n LearnableRegion python==3.9 -y
conda activate LearnableRegion

# 2. å®‰è£…PyTorchï¼ˆCUDA 11.8ç‰ˆæœ¬ï¼‰
pip install torch==2.0.1 torchvision==0.15.2 torchaudio==2.0.2 --index-url https://download.pytorch.org/whl/cu118

# 3. å®‰è£…å…¶ä»–ä¾èµ–åŒ…
conda env update --file enviroment.yaml
```

**æ³¨æ„ï¼š** ç¡®ä¿ä½ çš„ç³»ç»Ÿæœ‰ NVIDIA GPU å’Œ CUDA 11.8 æ”¯æŒã€‚

### ç¬¬äºŒæ­¥ï¼šå‡†å¤‡æ•°æ®

é¡¹ç›®å·²ç»åŒ…å«äº†ç¤ºä¾‹å›¾ç‰‡ï¼š
- `images/1.png`, `images/2.png`, `images/3.png`, `images/4.png`
- `images.json` é…ç½®æ–‡ä»¶å·²å­˜åœ¨

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œç¼–è¾‘

#### æ–¹å¼1ï¼šæ‰¹é‡ç¼–è¾‘å¤šå¼ å›¾ç‰‡

```bash
cd train
torchrun --nnodes=1 --nproc_per_node=2 train.py \
	--image_dir_path ../images/ \
	--output_dir ../output/ \
	--json_file ../images.json \
	--diffusion_model_path 'stabilityai/stable-diffusion-2-inpainting' \
	--draw_box \
	--lr 5e-3 \
	--max_window_size 15 \
	--per_image_iteration 10 \
	--epochs 1 \
	--num_workers 8 \
	--seed 42 \
	--pin_mem \
	--point_number 9 \
	--batch_size 1 \
	--save_path ../checkpoints/
```

### ç¬¬å››æ­¥ï¼šæŸ¥çœ‹ç»“æœ

ç¼–è¾‘å®Œæˆåï¼Œç»“æœä¼šä¿å­˜åœ¨ `output/` ç›®å½•ä¸‹ï¼š
- ç¼–è¾‘åçš„å›¾ç‰‡
- è¾¹ç•Œæ¡†å¯è§†åŒ–å›¾ç‰‡ï¼ˆå¦‚æœä½¿ç”¨äº† `--draw_box`ï¼‰

## âš™ï¸ é‡è¦å‚æ•°è°ƒæ•´

å¦‚æœéœ€è¦è°ƒæ•´ç¼–è¾‘æ•ˆæœæˆ–é€Ÿåº¦ï¼Œå¯ä»¥ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š

- **`max_window_size`**: å¢å¤§å¯ä»¥ç¼–è¾‘æ›´å¤§çš„åŒºåŸŸï¼Œä½†ä¼šå¢åŠ è®¡ç®—æ—¶é—´
- **`per_image_iteration`**: å¢åŠ å¯ä»¥æé«˜ç¼–è¾‘è´¨é‡ï¼Œä½†ä¼šå¢åŠ è®­ç»ƒæ—¶é—´
- **`point_number`**: å¢åŠ å¯ä»¥æ›´ç²¾ç¡®åœ°å®šä½ç¼–è¾‘åŒºåŸŸ

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡å‹ä¸‹è½½**ï¼šé¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ä» HuggingFace ä¸‹è½½æ¨¡å‹ï¼Œéœ€è¦ç½‘ç»œè¿æ¥
2. **GPUå†…å­˜**ï¼šå»ºè®®è‡³å°‘ 8GB æ˜¾å­˜çš„ GPU
3. **ç¼–è¾‘æ—¶é—´**ï¼šå•å¼ å›¾ç‰‡ç¼–è¾‘å¤§çº¦éœ€è¦ 4 åˆ†é’Ÿï¼ˆRTX 8000 GPUï¼‰
4. **æ¨¡å‹è·¯å¾„**ï¼šå¦‚æœé‡åˆ°æ¨¡å‹ä¸‹è½½é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨ä¸‹è½½åæŒ‡å®šæœ¬åœ°è·¯å¾„

## ğŸ”§ è‡ªå®šä¹‰ç¼–è¾‘

è¦ç¼–è¾‘ä½ è‡ªå·±çš„å›¾ç‰‡ï¼š

2. **å¤šå¼ å›¾ç‰‡**ï¼šå‚è€ƒ `images.json` çš„æ ¼å¼æ·»åŠ ä½ çš„å›¾ç‰‡é…ç½®

`images.json` æ ¼å¼ï¼š
```json
{
  "å›¾ç‰‡å.png": ["åŸå§‹æè¿°", "ç¼–è¾‘æç¤ºè¯"],
  "2.png": ["coffee", "soft drink"]
}
```

## ğŸ“ å¸¸è§é—®é¢˜

**Q: æç¤ºæ‰¾ä¸åˆ°æ¨¡å‹ï¼Ÿ**
A: ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œæˆ–ä½¿ç”¨ `--diffusion_model_path` æŒ‡å®šæœ¬åœ°æ¨¡å‹è·¯å¾„

**Q: æ˜¾å­˜ä¸è¶³ï¼Ÿ**
A: å‡å° `--batch_size` æˆ– `--max_window_size` å‚æ•°

**Q: ç¼–è¾‘æ•ˆæœä¸ç†æƒ³ï¼Ÿ**
A: å°è¯•å¢åŠ  `--per_image_iteration` æˆ–è°ƒæ•´ `--editing_prompt` çš„æè¿°
